# Pipeline de Change Data Capture com Kafka, Debezium, Spark, Postgres e MinIO

Projeto educacional construÃ­do para demonstrar, na prÃ¡tica, o
funcionamento de um pipeline de CDC e input em bucket e banco de dados relacional usando dados fake do Strava.

## ğŸ—‚ï¸ SumÃ¡rio

-   [ğŸ¯ Objetivo do Projeto](#-objetivo-do-projeto)
-   [ğŸ— Arquitetura Geral](#-arquitetura-geral)
-   [ğŸ“ Estrutura do RepositÃ³rio](#-estrutura-do-repositÃ³rio)
-   [ğŸ§° Tecnologias Utilizadas](#-tecnologias-utilizadas)
-   [ğŸš€ Como Executar o Projeto](#-como-executar-o-projeto)
-   [ğŸ§ª Como Testar os Eventos CDC](#-como-testar-os-eventos-cdc)
-   [ğŸ“¦ Conectores Kafka Connect](#-conectores-kafka-connect)
-   [ğŸ—„ï¸ Scripts SQL](#%EF%B8%8F-scripts-sql)
-   [ğŸ“ Exemplos de Eventos](#-exemplos-de-eventos-cdc)
-   [âš ï¸ ObservaÃ§Ãµes Importantes](#%EF%B8%8F-observaÃ§Ãµes-importantes)
-   [ğŸ‘©â€ğŸ’» Autora](#-autora)

------------------------------------------------------------------------

# ğŸ¯ Objetivo do Projeto

Este projeto demonstra um pipeline simples e funcional de CDC (Change
Data Capture) e input de eventos aplicando: 
- Captura de mudanÃ§as em tabela Postgres (dados fake do Strava) 
- PublicaÃ§Ã£o de eventos CDC no Kafka 
- Uso de Spark para consolidar eventos: 
- ğŸ˜ Postgres (eventos filtrados) 
- ğŸª£ MinIO (eventos crus)

------------------------------------------------------------------------

# ğŸ— Arquitetura Geral

 ![alt text](image.png)
------------------------------------------------------------------------

# ğŸ“ Estrutura do RepositÃ³rio

    CDC-Strava/
    â”œâ”€â”€ bash_exec/
    â”‚   â”œâ”€â”€ 01-exec_init.sh
    â”‚   â”œâ”€â”€ 02-exec_debezium.sh
    â”‚   â”œâ”€â”€ 03-exec_cdc.sh
    â”‚   â”œâ”€â”€ 04-exec_spark_to_minio.sh
    â”‚   â”œâ”€â”€ 05-exec_spark_to_postgres.sh
    â”‚
    â”œâ”€â”€ connectors/
    â”‚   â”œâ”€â”€ source-postgres-strava.json
    â”‚
    â”œâ”€â”€ docs/
    â”‚   â”œâ”€â”€ prints e diagramas diversos
    â”‚   â””â”€â”€ arquitetura_CDC_Strava.png
    â”‚
    â”œâ”€â”€ scripts/
    â”‚   â”œâ”€â”€ input_strava_init.sql
    â”‚   â””â”€â”€ cdc_create_events_change.sql
    â”‚  
    â”œâ”€â”€ spark/
    â”‚   â”œâ”€â”€ kafka_to_minio.py
    â”‚   â”œâ”€â”€ kafka_to_postgres.py        
    â”‚
    â”œâ”€â”€ docker-compose.yml
    â”œâ”€â”€ Dockerfile.connect
    â””â”€â”€ README.md

------------------------------------------------------------------------

# ğŸ§° Tecnologias Utilizadas

  Tecnologia          FunÃ§Ã£o
  ------------------- ----------------------------------------
  **Docker**          Ambientes isolados
  **PostgreSQL**      Fonte de dados fake + destino filtrado
  **Kafka**           Mensageria para eventos CDC
  **Debezium**        Captura de mudanÃ§as
  **Kafka Connect**   ExecuÃ§Ã£o de conectores
  **MinIO**           Armazenamento S3-like
  **Spark**           Camada intermediria em streaming para gerar dados no Minio e Postgress
  **Bash Scripts**    AutomaÃ§Ã£o do pipeline

------------------------------------------------------------------------

# ğŸš€ Como Executar o Projeto

Subir o ambiente

docker compose up -d

## 1ï¸âƒ£ Criar tabelas fake

    bash bash_exec/01-exec_init.sh

## 2ï¸âƒ£ Fazer modificaÃ§Ãµes nos dados

    bash bash_exec/03-exec_cdc.sh

## 3ï¸âƒ£ Criar conector Debezium para gerar um ambiente de CDC

    bash bash_exec/02-exec_debezium.sh

## 4ï¸âƒ£ ExecuÃ§Ãµes do spark para minio raw e postgres com filtro de delete

    bash bash_exec/04-exec_spark_to_minio.sh
    bash bash_exec/05-exec_spark_to_postgres.sh 

------------------------------------------------------------------------

# ğŸ§ª Como Testar os Eventos CDC

### Consumir mensagens no Kafka:

    docker exec -it kafka_cdc_strava kafka-console-consumer   --bootstrap-server localhost:9092   --topic strava.activities   --from-beginning

### Ver arquivos crus no MinIO:

Acessar: http://localhost:9011

### Ver tabela do Postgress:

    docker compose exec -T postgres_dest_cdc_strava psql -U postgres -d strava_dest -c "select count(*) from silver_strava_activities;"

------------------------------------------------------------------------

# ğŸ“¦ Conectores Kafka Connect

## ğŸ”¹ source-postgres-strava.json

Monitora tabela Postgres e envia eventos CDC ao Kafka.

------------------------------------------------------------------------

# ğŸ—„ï¸ Scripts SQL

  --------------------------------------------------------------------------
  Script                           DescriÃ§Ã£o
  -------------------------------- -----------------------------------------
  `input_strava_init.sql`          Cria & insere dados fake

  `cdc_create_events_change.sql`   Configura estruturas auxiliares para CDC
  --------------------------------------------------------------------------

------------------------------------------------------------------------

# ğŸ“ Exemplos de execuÃ§Ãµes

DisponÃ­veis em `docs/`

------------------------------------------------------------------------

# âš ï¸ ObservaÃ§Ãµes Importantes

-   Todos os dados sÃ£o fake.
-   Projeto totalmente local.
-   ConfiguraÃ§Ãµes podem variar conforme seu docker-compose.

------------------------------------------------------------------------

# ğŸ‘©â€ğŸ’» Autora

Rayane Correia â€” Analytics Engineer | PÃ³s-graduaÃ§Ã£o em Engenharia deÂ DadosÂ â€“Â UNIFOR
